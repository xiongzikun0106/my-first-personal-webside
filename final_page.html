<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>你终于找到这里了！</title>
    <link href="style.css" rel="stylesheet"/>
</head>
<body>
    <header>
        <img alt="image01" id="image01" src="images/image01.jpg" onclick="location.href='index.html'" style="cursor: pointer;"/>
    </header>

    <div>
        <h1>
            <span class="small">这里是</span>
            <span class="medium"><a href="https://x.com/mikotossd0106" target="_blank">御坂鱼坂</a></span>
        </h1>
        <p style="margin-top: 10px;">
            <span class="small">好吧这个人并</span>
            <span class="medium">不知道</span>
            <span class="small">写什么，请输入</span>
            <span class="medium">文本</span>
        </p>
    </div>

    <div id="ul01">
        <ul>
            <li><span class="small">关押在</span><span class="medium">十平米</span><span class="small">只有</span><span class="medium">床</span><span class="small">和</span><span class="medium">AMD 7500f + 4060ti</span><span class="small">的</span><span class="medium">电子牢房</span></li>
            <li><span class="small">收容措施：</span><span class="medium">23℃</span><span class="small">以及</span><span class="medium">30%湿度</span></li>
            </ul>
    </div>

    <div style="margin-top: 60px;">
        <h2>
            <span class="small">随机掉落的</span>
            <span class="medium">碎碎念</span>
            <span class="small">↓</span>
        </h2>
    </div>

    <div class="card-grid" id="blog-list">
        <p class="small">正在同步 AMD 7500f 节点数据...</p>
    </div>

    <div id="blog-content" style="margin-top: 20px; display: none; width: 100%;">
        <button class="back-btn" onclick="backToList()">← 返回列表</button>
        <div class="content-card" id="post-display-area"></div>
    </div>

    <script>
        // --- 初始化列表 ---
        async function initBlog() {
            const blogList = document.getElementById("blog-list");
            try {
                // 添加时间戳防止 GitHub Pages 缓存 posts.json
                const response = await fetch('data/posts.json?t=' + Date.now());
                const posts = await response.json();
                
                blogList.innerHTML = posts.map(post => `
                    <div class="blog-card" onclick="loadPost('${post.id}')">
                        <h4>${post.title}</h4>
                        <p class="small">${post.intro || '暂无简介'}</p>
                    </div>
                `).join('');
            } catch (error) {
                blogList.innerHTML = '<p class="small">⚠️ 无法连接到数据终端: ' + error.message + '</p>';
            }
        }

        // --- 加载正文 ---
        async function loadPost(postId) {
            const displayArea = document.getElementById("post-display-area");
            document.getElementById("blog-list").style.display = "none";
            document.getElementById("blog-content").style.display = "block";
            displayArea.innerHTML = '<p class="small">正在解密文档...</p>';
            window.scrollTo(0, 0);

            try {
                // 同样添加时间戳防止缓存
                const response = await fetch(`data/articles/${postId}.json?t=` + Date.now());
                const article = await response.json();

                const lines = article.content_lines || (article.content ? article.content.split('\n') : []);
                let images = article.images || [];
                if (!article.images && article.image) {
                    images.push({ name: article.image, insert_after: -1 });
                }

                let finalHtml = `<h3>${article.title}</h3>`;
                
                // 渲染插图逻辑
                const renderImg = (name) => `<img src="./images/${name}" class="blog-img" style="max-width:100%; border-radius:10px; margin:10px 0;">`;

                // 标题下图片
                images.filter(img => img.insert_after === -1).forEach(img => {
                    finalHtml += renderImg(img.name);
                });

                // 按行渲染正文
                lines.forEach((line, index) => {
                    if(line.trim() !== "") {
                        const isTime = line.includes("发布时间：");
                        finalHtml += `<p class="small" style="${isTime ? 'border-top: 1px dashed #ccc; margin-top:20px; padding-top:10px; color:#7f8c8d;' : 'margin-bottom:10px;'}">${line}</p>`;
                    }
                    // 行后图片
                    images.filter(img => img.insert_after === index).forEach(img => {
                        finalHtml += renderImg(img.name);
                    });
                });

                displayArea.innerHTML = finalHtml;
            } catch (error) {
                displayArea.innerHTML = `<p class="small" style="color:var(--accent-color)">⚠️ 访问拒绝: ${error.message}</p>`;
            }
        }

        function backToList() {
            document.getElementById("blog-list").style.display = "grid";
            document.getElementById("blog-content").style.display = "none";
        }

        window.addEventListener('DOMContentLoaded', initBlog);
    </script>
</body>
</html>